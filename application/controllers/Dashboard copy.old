<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Dashboard extends CI_Controller {

    public function __construct() {
        parent::__construct();
        $this->load->library('session');
        $this->load->helper(array('url','form'));
    }

    public function index() {
        $data = array();

        // Foydalanuvchi nomini sessiyadan olish
        $data['username'] = $this->session->userdata('username');

        // Menyu
        $data['menu'] = array(
            (object) ['title' => 'Rayosati Talim', 'link' => 'rayosati_talim'],
            (object) ['title' => 'Bosh sahifa', 'link' => 'bosh_sahifa'],
            (object) ['title' => 'Malumotlar', 'link' => 'malumotlar'],
            (object) ['title' => 'Hisobot', 'link' => 'hisobot'],
            (object) ['title' => 'Sozlamalar', 'link' => 'sozlamalar'],
            (object) ['title' => 'Aloqa', 'link' => 'aloqa']
        );

        $this->load->view('dashboard', $data);
    }

public function upload_file() {
    $destination = $this->input->post('destination');
    $allowed_pages = ['rayosati_talim','bosh_sahifa','malumotlar','hisobot','sozlamalar','aloqa'];
    if(empty($destination) || !in_array($destination, $allowed_pages)){
        $destination = 'dashboard';
    }

    $upload_path = './uploads/' . $destination . '/';
    if(!is_dir($upload_path)){
        mkdir($upload_path, 0777, true);
    }

    if(empty($_FILES['file']['name'])){
        $this->session->set_flashdata('info', "❌ Fayl tanlanmagan!");
        redirect('dashboard');
    }

    $config['upload_path']   = $upload_path;
    $config['allowed_types'] = '*';
    $config['max_size']      = 2048;

    $this->load->library('upload', $config);

    if (!$this->upload->do_upload('file')) {
        $error = $this->upload->display_errors();
        $this->session->set_flashdata('info', "❌ Xatolik yuz berdi: ".$error);
    } else {
        $upload_data = $this->upload->data();
        $this->session->set_flashdata('info', "✅ Xabar yuborildi!");
    }

    redirect('dashboard');
}


}